container:
  image: quay.io/droidian/build-essential:bookworm-amd64
  cpu: 8
  memory: 32G

build_task:
  preparation_script:
    - git clone https://github.com/anestisb/android-unpackbootimg.git
    - cd android-unpackbootimg
    - make
    - unpackbootimg -i ../boot.img
    - echo "========================================================================================"
    - mkdir -p droidian/{packages/buildd,kernel/xiaomi/rosy}/
    - KERNEL_DIR="droidian/kernel/xiaomi/rosy"
    - PACKAGES_DIR="droidian/packages"
    - git clone https://github.com/neizhmak/droidian_kernel_xiaomi_rosy.git -b bookworm $KERNEL_DIR
    - mkdir -p $KERNEL_DIR/buildd/sources/debian/source
    - echo 13 >> $KERNEL_DIR/buildd/sources/debian/compat
    - echo "3.0 (native)" >> $KERNEL_DIR/buildd/sources/debian/source/format
    - cp rules $KERNEL_DIR/buildd/sources/debian/
    - chmod +x $KERNEL_DIR/buildd/sources/debian/rules
    - ls $KERNEL_DIR
  get_source_script:
    - 
  build_script:
    - exit
  env:
    GITHUB_TOKEN: ENCRYPTED[b28f79174c63e23e95a6767888d6b64b4c377572a2a4ee842cc115cce0e2d9f4dc6a655053bea7928630ae64dbefffee]
  publish_release_script:
    - source ../publish_release.sh
